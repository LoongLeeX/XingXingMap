<!DOCTYPE html>
<html>
  <head>
    <title>Test 3D Map with Markers</title>
    <style>
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #map-container {
        width: 100%;
        height: 100%;
      }
      gmp-map-3d {
        width: 100%;
        height: 100%;
      }
      #info {
        position: absolute;
        top: 10px;
        left: 10px;
        background: white;
        padding: 10px;
        border-radius: 5px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        font-family: Arial, sans-serif;
        z-index: 1000;
      }
    </style>
  </head>
  <body>
    <div id="info">
      <h3>3D åœ°å›¾ + æ ‡è®°æµ‹è¯•</h3>
      <p>ğŸ—ºï¸ æ—§é‡‘å±±é‡‘é—¨å¤§æ¡¥</p>
      <p>ğŸ“ å¤šä¸ª 3D æ ‡è®°</p>
    </div>
    <div id="map-container"></div>
    
    <!-- åŠ è½½ Maps JavaScript APIï¼Œæ³¨æ„ v=alpha å’Œ libraries=maps3d -->
    <script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBfyQNsQWu3HdhfOxcZnL7YkKOI-RJI_D0&v=alpha&libraries=maps3d&callback=init"></script>
    
    <script>
      async function init() {
        console.log('ğŸš€ åˆå§‹åŒ– 3D åœ°å›¾...');
        
        try {
          // æ£€æŸ¥ Google Maps API æ˜¯å¦åŠ è½½
          if (!window.google || !window.google.maps) {
            throw new Error('Google Maps API æœªåŠ è½½');
          }
          console.log('âœ… Google Maps API å·²åŠ è½½');
          
          if (!window.google.maps.importLibrary) {
            throw new Error('importLibrary æ–¹æ³•ä¸å¯ç”¨');
          }
          console.log('âœ… importLibrary æ–¹æ³•å¯ç”¨');
          
          // å¯¼å…¥ maps3d åº“
          console.log('ğŸ“¦ æ­£åœ¨å¯¼å…¥ maps3d åº“...');
          const maps3dLib = await google.maps.importLibrary("maps3d");
          console.log('âœ… maps3d åº“å¯¼å…¥ç»“æœ:', maps3dLib);
          
          // æ£€æŸ¥æ˜¯å¦æœ‰ Map3DElement å’Œ Marker3DElement
          if (!maps3dLib.Map3DElement) {
            throw new Error('Map3DElement ä¸å¯ç”¨ï¼Œè¯·æ£€æŸ¥ API Key å’Œ Map Tiles API æ˜¯å¦å¯ç”¨');
          }
          if (!maps3dLib.Marker3DElement) {
            throw new Error('Marker3DElement ä¸å¯ç”¨');
          }
          
          const { Map3DElement, Marker3DElement } = maps3dLib;
          console.log('âœ… Map3DElement å’Œ Marker3DElement å·²è·å–');
          
          // åˆ›å»º 3D åœ°å›¾
          const map = new Map3DElement({
            center: { 
              lat: 37.8199, 
              lng: -122.4783, 
              altitude: 0 
            },
            tilt: 67.5,
            range: 1500,
            heading: 330,
            mode: 'SATELLITE'  // å¯é€‰: SATELLITE, HYBRID, UNLIT
          });
          console.log('âœ… 3D åœ°å›¾åˆ›å»ºæˆåŠŸ');
          
          // åˆ›å»ºå¤šä¸ªæ ‡è®°
          
          // æ ‡è®° 1: é‡‘é—¨å¤§æ¡¥åŒ—ç«¯
          const marker1 = new Marker3DElement({
            position: { 
              lat: 37.8199, 
              lng: -122.4783, 
              altitude: 100 
            },
            altitudeMode: "ABSOLUTE",
            extruded: true,
            label: "ğŸŒ‰ é‡‘é—¨å¤§æ¡¥åŒ—ç«¯"
          });
          console.log('âœ… æ ‡è®° 1 åˆ›å»ºæˆåŠŸ');
          
          // æ ‡è®° 2: é‡‘é—¨å¤§æ¡¥å—ç«¯
          const marker2 = new Marker3DElement({
            position: { 
              lat: 37.8089, 
              lng: -122.4755, 
              altitude: 80 
            },
            altitudeMode: "ABSOLUTE",
            extruded: true,
            label: "ğŸŒ‰ é‡‘é—¨å¤§æ¡¥å—ç«¯"
          });
          console.log('âœ… æ ‡è®° 2 åˆ›å»ºæˆåŠŸ');
          
          // æ ‡è®° 3: æ›´é«˜çš„æ ‡è®°
          const marker3 = new Marker3DElement({
            position: { 
              lat: 37.8144, 
              lng: -122.4769, 
              altitude: 200 
            },
            altitudeMode: "ABSOLUTE",
            extruded: true,
            label: "ğŸ“ é«˜å¤„è§‚æ™¯ç‚¹"
          });
          console.log('âœ… æ ‡è®° 3 åˆ›å»ºæˆåŠŸ');
          
          // æ ‡è®° 4: åœ°é¢æ ‡è®°ï¼ˆCLAMP_TO_GROUNDï¼‰
          const marker4 = new Marker3DElement({
            position: { 
              lat: 37.8250, 
              lng: -122.4800, 
              altitude: 0 
            },
            altitudeMode: "CLAMP_TO_GROUND",
            extruded: false,
            label: "ğŸ–ï¸ åœ°é¢ç‚¹"
          });
          console.log('âœ… æ ‡è®° 4 åˆ›å»ºæˆåŠŸ');
          
          // å°†æ‰€æœ‰æ ‡è®°æ·»åŠ åˆ°åœ°å›¾
          map.append(marker1);
          map.append(marker2);
          map.append(marker3);
          map.append(marker4);
          console.log('âœ… æ‰€æœ‰æ ‡è®°å·²æ·»åŠ åˆ°åœ°å›¾');
          
          // å°†åœ°å›¾æ·»åŠ åˆ°é¡µé¢
          document.getElementById('map-container').appendChild(map);
          console.log('âœ… åœ°å›¾å·²æ·»åŠ åˆ°é¡µé¢');
          
          console.log('ğŸ‰ 3D åœ°å›¾å’Œæ ‡è®°åˆå§‹åŒ–å®Œæˆï¼');
          
          // å¯é€‰ï¼šæ·»åŠ åœ°å›¾äº¤äº’ç›‘å¬
          map.addEventListener('gmp-click', (event) => {
            console.log('ğŸ–±ï¸ åœ°å›¾è¢«ç‚¹å‡»:', event);
          });
          
        } catch (error) {
          console.error('âŒ åˆå§‹åŒ–å¤±è´¥:', error);
          document.getElementById('info').innerHTML = `
            <h3>âŒ åŠ è½½å¤±è´¥</h3>
            <p>${error.message}</p>
          `;
        }
      }
      
      // å¦‚æœè„šæœ¬ä¸æ˜¯ async åŠ è½½ï¼Œæ‰‹åŠ¨è°ƒç”¨
      if (typeof google !== 'undefined') {
        init();
      }
    </script>
  </body>
</html>

